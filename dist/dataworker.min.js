/*!
 * DataWorker v3.0.0 (http://git.io/dw)
 * Copyright 2014-2015 Rentrak Corporation and other contributors
 * Licensed under MIT (https://github.com/dataworker/dataworker/blob/master/LICENSE)
 */
function DataWorkerHelperCreator(a){"use strict";function b(a){return"string"==typeof a?a:JSON.stringify(a)}function c(a,b){for(var c=a.length,d=0,e=b.length;c>d;)b[e++]=a[d++]}var d,e=function(){var a=this instanceof e?this:Object.create(e.prototype);return a._columns={},a._rows=[],a._summaryRows=[],a._partitionedBy=[],a._partitionedRows={},a._expectedNumRows,a._wsDatasource,a._wsAuthenticate,a._socket,a._cancelRequestsCmd,a._cancelRequestsAck,a._waitForCancelRequestsAck=!1,a._onSocketClose,a._shouldAttemptReconnect=!1,a._ajaxDatasource,a._ajaxAuthenticate,a._ajaxRequests=[],a._ajaxRequestCounter=0,a._shouldClearDataset=!1,a._rowsPerPage=10,a._currentPage=void 0,a._onlyValidForNumbersRegex=/[^0-9.e\-]/g,a._hasChildElements=!1,a._isFinished=!1,a._replyQueue=[],a};e.prototype.handleMessage=function(a){var b=this,c={};if("undefined"!=typeof a){if("initialize"===a.cmd)return b.initialize(a);"postMessage"===a.cmd?b._sendThroughWebSocket(a):a.cmd in b?c=b[a.cmd](a):c.error="Unrecognized DataWorker command: "+a.cmd,c&&b._postMessage(c)}},"undefined"==typeof window?(e.prototype._postMessage=function(b,c){this._isFinished||(a.postMessage(b),c&&this._finish())},a.onmessage=function(a){d||(d=new e),d.handleMessage(a.data)}):(e.prototype._postMessage=function(a,b){var c=this;c._replyQueue.push([a,b]),setTimeout(function(){var a=c._replyQueue.shift(),b=a[0],d=a[1];c._isFinished||(c.onmessage({data:b}),d&&c._finish())})},e.prototype.postMessage=function(){var a=this,b=arguments;setTimeout(function(){a.handleMessage.apply(a,b)})},e.prototype.terminate=function(){this.onmessage=null},window.DataWorkerHelper=e),e.prototype.finish=function(){var a=this;a._socket&&0!==a._socket.readyState&&3!==a._socket.readyState&&(void 0!==a._onSocketClose&&a._socket.send(a._onSocketClose),a._socket.onclose=function(){},a._socket.close()),a._postMessage({},!0)},e.prototype._finish=function(){var a=this;a._isFinished=!0,d=null},e.prototype.initialize=function(a){var c=this,d="string"==typeof a.datasource?{source:a.datasource}:a.datasource;c._wsDatasource=c._socket=c._ajaxDatasource=void 0;try{if("undefined"==typeof d)c._columns=c._prepareColumns(a.columns),c._rows=c._prepareRows(a.rows),c._postMessage({connected:!0});else if(/^(?:https?|file):\/\//.test(d.source))c._ajaxDatasource=d.source,c._ajaxAuthenticate=d.authenticate||a.authenticate,c._isLocalAjax=/^file/.test(d.source),c._verifyAjaxDatasource(a);else{if(!/^wss?:\/\//.test(d.source))throw new Error("Could not initialize DataWorker; unrecognized datasource.");c._wsDatasource=d.source,c._wsAuthenticate=b(d.authenticate||a.authenticate),c._cancelRequestsCmd=b(d.cancelRequestsCmd),c._cancelRequestsAck=b(d.cancelRequestsAck),c._shouldAttemptReconnect=a.shouldAttemptReconnect,c._initializeWebsocketConnection(a)}}catch(e){var f=e.message,g=e.stack,h=c._wsDatasource&&!c._socket;g&&(f+="\n\n"+g),c._postMessage({connected:!1,error:f,unsupported:h})}return c},e.prototype._verifyAjaxDatasource=function(a){var b=this,c=new XMLHttpRequest;return c.onreadystatechange=function(){4===this.readyState&&((b._isLocalAjax?this.response:200===this.status)?(b._postMessage({connected:!0}),"undefined"!=typeof a.request&&b.requestDataset(a)):b._postMessage({connected:!1,unsupported:0===this.status}))},c.open("HEAD",b._ajaxDatasource),c.send(),!0},e.prototype._getRequestParams=function(a){var b="";try{if(a){"string"==typeof a&&(a=JSON.parse(a));for(var c in a)b+=c+"="+encodeURIComponent(a[c])+"&"}}catch(d){"string"==typeof a&&(b+=a)}return b},e.prototype._processInput=function(a,b){var d,e=this;try{d="string"==typeof a?JSON.parse(a):a}catch(f){return e._postMessage({error:"Error "+f.message+": "+a})}if(d.error)return e._postMessage({error:d.error});if(d.trigger&&e._postMessage({triggerMsg:d.msg}),d.columns){e._shouldClearDataset&&e.clearDataset();var f=e._checkColumnsForAppend(d.columns);if(f)return e._postMessage({error:f})}if("INFINITE"===d.expectedNumRows?e._expectedNumRows=d.expectedNumRows:void 0!==d.expectedNumRows&&(void 0===e._expectedNumRows&&(e._expectedNumRows=0),e._expectedNumRows+=parseInt(d.expectedNumRows)),d.rows){var g=e._prepareRows(d.rows);c(g,e._rows),e._partitionedBy.length>0&&e._insertIntoPartitionedRows(g),e._postMessage("INFINITE"!==e._expectedNumRows&&e._rows.length===e._expectedNumRows?{allRowsReceived:!0}:{rowsReceived:d.rows.length})}void 0!==e._columns&&(void 0!==d.expectedNumRows||d.rows&&d.columns)&&e._postMessage({columnsReceived:!0}),d.summaryRows&&c(e._prepareRows(d.summaryRows),e._summaryRows),(0===parseInt(d.expectedNumRows)||void 0===e._expectedNumRows&&b)&&e._postMessage({allRowsReceived:!0})},e.prototype._ajax=function(a){var b=this,c=new XMLHttpRequest,d=b._ajaxDatasource+(/^\?/.test(a)?"":"?"),e=0,f=b._ajaxRequestCounter;b._ajaxRequests.push(c),d+=b._getRequestParams(a),d+=b._getRequestParams(b._ajaxAuthenticate),c.onreadystatechange=function(){if(f===b._ajaxRequestCounter&&c.readyState>2&&(b._isLocalAjax?c.response:200===c.status)){var a=c.responseText.substr(e).split(/([\r\n]+)/);a[a.length-1]&&3===c.readyState&&a.pop(),a.forEach(function(a,d){e+=a.length,d%2||b._processInput(a||{},4===c.readyState)})}},c.open("GET",d,!0),c.send()},e.prototype._initializeWebsocketConnection=function(a){var b=this;return b._wsDatasource?(b._socket=new WebSocket(b._wsDatasource),b._socket.onopen=function(){b._wsAuthenticate&&b._socket.send(b._wsAuthenticate),"undefined"!=typeof a.request&&b._socket.send(a.request),b._postMessage({connected:!0})},b._socket.onclose=function(c){b._shouldAttemptReconnect&&1e3!==c.code&&1001!==c.code&&b._initializeWebsocketConnection(a)},b._socket.onerror=function(a){0===a.target.readyState||3===a.target.readyState?(b._socket=null,b._postMessage({connected:!1})):b._postMessage({error:"Error: Problem with connection to datasource."})},b._socket.onmessage=function(a){return b._waitForCancelRequestsAck&&a.data===b._cancelRequestsAck?(b._waitForCancelRequestsAck=!1,void b._postMessage({})):void b._processInput(a.data)},b._onSocketClose=a.onClose,!0):!1},e.prototype._prepareColumns=function(a){var b={};return a.forEach(function(a,c){"string"==typeof a&&(a={name:a}),a.sortType=a.sortType||"alpha",a.aggType=a.aggType||"max",a.title="title"in a?a.title:a.name,a.index=c,a.isVisible="isVisible"in a?a.isVisible:!0,b[a.name]=a}),b},e.prototype._prepareRows=function(a){return a.map(function(a){return a instanceof Array?{row:a,isVisible:!0}:a})},e.prototype._getVisibleColumns=function(){var a=this,b={},c=0;return Object.keys(a._columns).sort(function(b,c){return a._columns[b].index-a._columns[c].index}).forEach(function(d){a._columns[d].isVisible&&(b[d]=JSON.parse(JSON.stringify(a._columns[d])),b[d].index=c++)}),b},e.prototype._getVisibleRows=function(a,b,d,e){var f=this,g=[],h=[],i={};if((a||[]).length||(a=void 0),b=b||f._rows,f._hasChildElements){var j=[];b.forEach(function(a){j.push(a),a.hasChildren&&c(a.children,j)}),b=j}return(a||Object.keys(f._columns)).forEach(function(b){var c=f._columns[b];c&&(a||c.isVisible)&&g.push(c.index)}),b.forEach(function(a){if(a.isVisible||d){var b=g.map(function(b){return f._getCellDisplayValueByIndex(a,b)});if(b.parentRow=a.parentRow,e){var c=!0,j=i;if(b.forEach(function(a){(c=c&&j[a])||(j[a]={}),j=j[a]}),c)return}h.push(b)}}),h},e.prototype._insertIntoPartitionedRows=function(a){var b=this;b._hashRowsByKeyColumns(b._partitionedBy,a,b._partitionedRows,!0)},e.prototype._alphaSort=function(a,b){return a=(a||"").toLowerCase(),b=(b||"").toLowerCase(),b>a?-1:a>b?1:0},e.prototype._localeAlphaSort=function(a,b){return a=(a||"").toLowerCase(),b=(b||"").toLowerCase(),a.localeCompare(b)},e.prototype._numSort=function(a,b){var c=this;return a+="",a=a.replace(c._onlyValidForNumbersRegex,""),c._decimalMarkCharacter&&(a=a.replace(c._decimalMarkCharacter,".")),a=parseFloat(a),b+="",b=b.replace(c._onlyValidForNumbersRegex,""),c._decimalMarkCharacter&&(b=b.replace(c._decimalMarkCharacter,".")),b=parseFloat(b),isNaN(a)||isNaN(b)?isNaN(a)&&isNaN(b)?0:isNaN(a)?-1:1:a-b},e.prototype._scanRows=function(a){var b=this,c=a.filters,d=[],e=[];return Object.keys(b._columns).forEach(function(a){e.push(b._columns[a].index),d[b._columns[a].index]="num"===b._columns[a].sortType}),("string"==typeof c[0]||c[0]instanceof RegExp)&&(c=[{columns:c[1]instanceof Array?c[1]:c.slice(1),regex:RegExp(c[0])}]),c=c.map(function(a){return a.column&&(a.columns=[a.column]),"string"==typeof a.columns&&(a.columns=[a.columns]),a.indices=a.columns&&a.columns.length?a.columns.reduce(function(a,c){var d=b._columns[c];return d&&a.push(d.index),a},[]):e,a.tests=["eq","ne","gte","gt","lte","lt","regex","!regex"].filter(function(b){return b in a}),["regex","!regex"].forEach(function(b){a[b]&&(a[b]=RegExp(a[b]))}),a}).filter(function(a){return a.indices.length}),b._rows.reduce(function(e,f){if(!f.isVisible&&!a.allRows)return e;var g=c.every(function(a){return a.indices[a.matchAll?"every":"some"](function(c){return a.tests.every(function(e){return b._testCell(b._getCellRawValueByIndex(f,c),a,d[c],e)})})});return g?a.setVisibility?f.isVisible=!0:e.push(f):a.setVisibility&&(f.isVisible=!1),e},[])},e.prototype._testCell=function(a,b,c,d){switch(c&&(a=parseFloat(a)),d){case"regex":return b.regex.test(a);case"!regex":return!b["!regex"].test(a);case"eq":return a==b.eq;case"ne":return a!=b.ne;case"gte":return a>=b.gte;case"gt":return a>b.gt;case"lte":return a<=b.lte;case"lt":return a<b.lt}},e.prototype._extractColumnNamesInOrder=function(a){var b=this;return Object.keys(a).sort(function(c,d){return b._numSort(a[c].index,a[d].index)})},e.prototype._checkColumnsForAppend=function(a){var b,c,d=this;if(a instanceof Array&&(a=d._prepareColumns(a)),0===Object.keys(d._columns).length)return void(d._columns=a);if(c=function(){var b=d._extractColumnNamesInOrder(d._columns).join(", "),c=d._extractColumnNamesInOrder(a).join(", ");return"Cannot append dataset (columns do not match):\n	"+b+"\n		VS\n	"+c},Object.keys(a).length!==Object.keys(d._columns).length)return c();var e=Object.keys(a);for(b=0;b<e.length;b++){var f=e[b];if("undefined"==typeof d._columns[f])return c();if(a[f].index!==d._columns[f].index)return c()}},e.prototype._hashRowsByKeyColumns=function(a,b,c,d){var e=this,f=a.map(function(a){return e._columns[a].index});return b.forEach(function(a){var b=f.map(function(b){return e._getCellRawValueByIndex(a,b)}).join("|");b in c?c[b].push(d?a:a.row):c[b]=[d?a:a.row]}),c},e.prototype._hashDatasetByKeyColumns=function(a,b){var c=this,d=a.keyColumns,e={},f=[],g={};return d=d instanceof Array?d:[d],d.forEach(function(a){!a in c._columns&&f.push('Column "'+a+'" not in dataset.')}),c._hashRowsByKeyColumns(d,c._rows,e,b),g.hash=e,f.length&&(g.error=f.join("\n")),g},e.prototype._getLastPage=function(a){var b=this,c=b._getVisibleRows(a.columnNames);return{visibleRows:c,lastPage:Math.ceil(c.length/b._rowsPerPage)-1}},e.prototype._hideShowColumns=function(a,b){var c=this;"columnNames"in a?a.columnNames.forEach(function(a){a in c._columns&&(c._columns[a].isVisible=b)}):"columnNameRegex"in a?Object.keys(c._columns).forEach(function(d){RegExp(a.columnNameRegex).test(d)&&(c._columns[d].isVisible=b)}):"property"in a&&Object.keys(c._columns).forEach(function(d){var e=c._columns[d];e[a.property.property]===a.property.value&&(e.isVisible=b)})},e.prototype._getCellValue=function(a,b,c){var d=a.row[b];if("object"==typeof d&&null!==d){if(void 0!==d[c])return d[c];throw new Error("Unrecognized cell value format: "+d)}return d},e.prototype._getCellDisplayValueByIndex=function(a,b){var c=this;return c._getCellValue(a,b,"display")},e.prototype._getCellRawValueByIndex=function(a,b){var c=this;return c._getCellValue(a,b,"raw")},e.prototype._getCellRawValueByColumn=function(a,b){var c=this;return c._getCellRawValueByIndex(a,c._columns[b].index)},e.prototype.sort=function(a){function b(a,b){var e,f,g,h,i,j,k,l;for(e=0;e<d.length;e++){if(f=d[e].match(/(-?)(\w+)/),g=f[2],h=!!f[1],i=c._columns[g].sortType,h?(l=c._getCellRawValueByColumn(a,g),k=c._getCellRawValueByColumn(b,g)):(k=c._getCellRawValueByColumn(a,g),l=c._getCellRawValueByColumn(b,g)),"alpha"===i)j=c._alphaSort(k,l);else if("localeAlpha"===i)j=c._localeAlphaSort(k,l);else{if("num"!==i)throw new Error("Unknown sort type.");j=c._numSort(k,l)}if(0!==j)return j}return 0}var c=this,d=a.sortOn,e=a.rows||c._rows;return e.sort(b),c._hasChildElements&&e.forEach(function(a){a.hasChildren&&a.children.sort(b)}),{}},e.prototype.setDecimalMarkCharacter=function(a){var b=this;return b._onlyValidForNumbersRegex=new RegExp("[^0-9e\\-"+(b._decimalMarkCharacter=a.decimalMarkCharacter)+"]","g"),{}},e.prototype.search=function(a){var b=this,c=b._scanRows({setVisibility:!1,filters:a.filters,allRows:a.allRows});return"string"==typeof a.sortOn&&(a.sortOn=[a.sortOn]),"string"==typeof a.columns&&(a.columns=[a.columns]),"string"==typeof a.returnColumns&&(a.returnColumns=[a.returnColumns]),a.sortOn&&b.sort({rows:c,sortOn:a.sortOn}),c=b._getVisibleRows(a.returnColumns||a.columns,c,!0,a.getDistinct),a.limit>0&&(c=c.slice(a.fromRow,a.fromRow+a.limit)),{rows:c}},e.prototype.applyFilter=function(a){var b=this;return a.setVisibility=!0,b._scanRows(a),{}},e.prototype.clearFilters=function(){var a=this;return a._rows.forEach(function(a){a.isVisible=!0}),{}},e.prototype.filter=function(a){var b=this;return b._rows=b._scanRows(a),{}},e.prototype.applyLimit=function(a){var b=this,c=a.numRows,d=0;return b._rows.forEach(function(a){a.isVisible=d++<c?!0:!1}),{}},e.prototype.limit=function(a){var b=this,c=a.numRows;return b._rows=b._rows.slice(0,c),{}},e.prototype.removeColumns=function(a){var b=this,c=a.columnsToRemove,d={};return Object.keys(b._columns).forEach(function(a,e){if(-1===c.indexOf(a)){var f=b._columns[a];f.index=e,d[a]=f}}),b._rows.forEach(function(a){var c=[];Object.keys(d).forEach(function(e){c[d[e].index]=a.row[b._columns[e].index]}),a.row=c}),b._columns=d,{}},e.prototype.prependColumnNames=function(a){var b=this,c=a.prepend,d={};return Object.keys(b._columns).forEach(function(a){d[c+a]=b._columns[a]}),b._columns=d,{}},e.prototype.alterColumnName=function(a){var b,c=this,d=a.oldName,e=a.newName;return Object.keys(c._columns).forEach(function(a){a!==d&&a===e&&(b="Column "+e+" already exists in the dataset.")}),c._columns[e]=c._columns[d],delete c._columns[d],"undefined"==typeof b?{}:{error:b}},e.prototype.alterColumnSortType=function(a){var b=this,c=a.column,d=a.sortType;return b._columns[c].sortType=d,{}},e.prototype.alterColumnAggType=function(a){var b=this,c=a.column,d=a.aggType;return b._columns[c].aggType=d,{}},e.prototype.alterColumnTitle=function(a){var b=this,c=a.column,d=a.title;return b._columns[c].title=d,{}},e.prototype.append=function(a){var b=this;if(a.newColumns){var c=b._checkColumnsForAppend(a.newColumns);if(c)return{error:c}}return b._rows.splice.apply(b._rows,["index"in a?a.index:b._rows.length,0].concat(a.preparedRows||b._prepareRows(a.newRows))),{}},e.prototype.hash=function(a){var b=this;return b._hashDatasetByKeyColumns(a)},e.prototype.join=function(a){var b=this,c=b._hashDatasetByKeyColumns(a),d=a.rHash,e=a.joinType,f=a.fColumns;if("error"in c)return{error:c.error};c=c.hash;var g=[],h="right"===e?d:c,i="right"===e?c:d,j=i[Object.keys(i)[0]][0].map(function(){return""}),k=Object.keys(b._columns).length;return e="undefined"==typeof e?"inner":e,Object.keys(h).forEach(function(a){a in i?h[a].forEach(function(b){i[a].forEach(function(a){g.push("right"===e?a.concat(b):b.concat(a))})}):"inner"!==e&&h[a].forEach(function(a){g.push("right"===e?j.concat(a):a.concat(j))})}),Object.keys(f).forEach(function(a){var c=f[a];c.index+=k,b._columns[a]=c}),b._rows=b._prepareRows(g),{}},e.prototype.group=function(a){var b=this,c=b._hashDatasetByKeyColumns(a),d=a.keyColumns,e=[],f=[];return"error"in c?{error:c.error}:(c=c.hash,Object.keys(c).forEach(function(a){var g=[];c[a].forEach(function(a){Object.keys(b._columns).forEach(function(c){var e=b._columns[c].aggType,h=b._columns[c].index,i=-1!==d.indexOf(c);h in g&&!i?"sum"===e?g[h]+=a[h]:"max"===e?g[h]=g[h]<a[h]?a[h]:g[h]:"min"===e?g[h]=g[h]>a[h]?a[h]:g[h]:f.push('Unrecognized aggType for columm "'+c+'".'):g[h]=a[h]})}),e.push(g)}),b._rows=b._prepareRows(e),f.length>0?{error:f.join("\n")}:{})},e.prototype.partition=function(a){var b=this,c=b._hashDatasetByKeyColumns(a,!0);if("error"in c)return{error:c.error};c=c.hash,b._partitionedBy=a.keyColumns;Object.keys(b._columns).map(function(a){return b._columns[a]}).sort(function(a,c){return b._numSort(a.index,c.index)});return Object.keys(c).forEach(function(a){var d=c[a];b._partitionedRows[a]=d}),{}},e.prototype.getPartitionKeys=function(){var a=this,b=Object.keys(a._partitionedRows).map(function(a){return a.split("|")});return{keys:b}},e.prototype.getPartitioned=function(a){var b=this,c=b._partitionedRows[a.key];return{rows:c?b._getVisibleRows(void 0,b._partitionedRows[a.key]):[]}},e.prototype.sortPartition=function(a){var b=this;return"string"===a.sortOn&&(a.sortOn=[a.sortOn]),b.sort({rows:b._partitionedRows[a.key],sortOn:a.sortOn}),{}},e.prototype.getDataset=function(a){var b=this;return{rows:b._getVisibleRows(a.columnNames)}},e.prototype.getDistinctConsecutiveRows=function(a){var b,c=this,d=c._getVisibleRows([a.columnName]),e=[],f=0;return d.forEach(function(a,c){(!c||!a.parentRow&&b!=a[0])&&(e.length&&(e[f++][2]=c-1),b=a[0],e.push([b,c,c]))}),e.length&&(e[f++][2]=d.length-1),{distinctRows:e}},e.prototype.getNumberOfRecords=function(){var a=this;return{numRows:a._getVisibleRows().length}},e.prototype.paginate=function(a){var b=this;return b._rowsPerPage=a.rowsPerPage,{}},e.prototype.getPage=function(a){var b,c,d=this,e=d._getLastPage(a);return a.lastPage=e.lastPage,d.setPage(a),b=d._rowsPerPage*d._currentPage,c=b+d._rowsPerPage,{rows:e.visibleRows.slice(b,c),currentPage:d._currentPage+1}},e.prototype.setPage=function(a){var b=this;return"lastPage"in a||(a.lastPage=b._getLastPage(a).lastPage),"undefined"!=typeof a.pageNum?b._currentPage=a.pageNum-1:"undefined"==typeof b._currentPage?b._currentPage=0:a.incrementPage?b._currentPage++:a.decrementPage&&b._currentPage--,b._currentPage<0&&(b._currentPage=0),b._currentPage>a.lastPage&&(b._currentPage=a.lastPage),{currentPage:b._currentPage+1}},e.prototype.getNumberOfPages=function(a){var b=this,c=b._getLastPage(a);return{numberOfPages:c.lastPage+1}},e.prototype.hideColumns=function(a){var b=this;return b._hideShowColumns(a,!1),{}},e.prototype.showColumns=function(a){var b=this;return b._hideShowColumns(a,!0),{}},e.prototype.hideAllColumns=function(){var a=this;return Object.keys(a._columns).forEach(function(b){a._columns[b].isVisible=!1}),{}},e.prototype.showAllColumns=function(){var a=this;return Object.keys(a._columns).forEach(function(b){a._columns[b].isVisible=!0}),{}},e.prototype.getAllColumns=function(){var a=this;return{columns:a._columns}},e.prototype.getColumns=function(){var a=this;return{columns:a._getVisibleColumns()}},e.prototype.getRows=function(a){var b=this,c=a.start,d=a.end;return"undefined"!=typeof d&&(d=parseInt(d)+1),{rows:b.getDataset(a).rows.slice(c,d)}},e.prototype.getHashedRows=function(a){var b=this,c=a.columnNames,d=b.getRows(a).rows;return c.length||(c=b.getColumns().columns,c=Object.keys(c).sort(function(a,b){return c[a].index-c[b].index})),{rows:d.map(function(a){return c.reduce(function(b,c,d){return b[c]=a[d],b},{})})}},e.prototype.getSummaryRows=function(a){var b=this;return{summaryRows:b._getVisibleRows(a.columnNames,b._summaryRows)}},e.prototype.setSummaryRows=function(a){var b=this;return b._summaryRows=b._prepareRows(a.summaryRows),{}},e.prototype.getExpectedNumRows=function(){var a=this;return{exNumRows:a._expectedNumRows}},e.prototype.clearDataset=function(){var a=this;return a._columns={},a._rows=[],a._summaryRows=[],a._partitionedRows=[],a._expectedNumRows=void 0,a._shouldClearDataset=!1,{}},e.prototype.requestDataset=function(a){var b=this;return b._shouldClearDataset=!0,b.requestDatasetForAppend(a)},e.prototype.requestDatasetForAppend=function(a){var b=this,c=!1;return"undefined"!=typeof b._socket?(b._socket.send(a.request),c=!0):"undefined"!=typeof b._ajaxDatasource&&(b._ajax(a.request),c=!0),c?{}:{error:"Could not request dataset; no datasource defined."}},e.prototype.addChildRows=function(a){var b=this,c=b._prepareRows(a.rows),d=b._hashRowsByKeyColumns([a.joinOn],c,{},!0),e=b._columns[a.joinOn].index;return b._rows.forEach(function(a){var c=d[b._getCellRawValueByIndex(a,e)];c&&(b._hasChildElements=!0,a.hasChildren=!0,a.children=c,c.forEach(function(b){b.parentRow=a,b.isVisible=a.isVisible}))}),{}},e.prototype.refresh=function(){var a=this;return{columns:a._getVisibleColumns(),rows:a._getVisibleRows()}},e.prototype.refreshAll=function(a){var b=this,c=b._rows.map(a.complexValues?function(a){return a.row}:function(a){return a.row.map(function(c,d){return b._getCellDisplayValueByIndex(a,d)})});return{columns:b._columns,rows:c}},e.prototype.cancelOngoingRequests=function(){var a=this;if(a._ajaxDatasource)a._ajaxRequests.forEach(function(a){a.abort()}),a._ajaxRequests=[],a._ajaxRequestCounter++;else if(a._wsDatasource&&void 0!==a._socket&&void 0!==a._cancelRequestsCmd&&(a._waitForCancelRequestsAck=!!a._cancelRequestsAck,a._socket.send(a._cancelRequestsCmd),a._waitForCancelRequestsAck))return;return{}},e.prototype._sendThroughWebSocket=function(a){var b=this;"undefined"!=typeof b._socket&&0!==b._socket.readyState&&3!==b._socket.readyState&&b._socket.send(a.message)}}!function(){"use strict";if("undefined"!=typeof window){var a=window.WebWorkerPool=function(b){var c=this instanceof a?this:Object.create(a.prototype);return c._workers={},c._src=b,c};if("undefined"==typeof window||void 0===window.Worker)return a;a.prototype.getWorker=function(a,b){var c,d=this,e=[].concat(a||d._src||[]);return e.some(function(a){var e=d._workers[a];if("ignore"===e)return!1;if(c=e&&e.length&&e.pop())return!0;if(b)return!1;try{return c=new Worker(a),c.source=a,d._workers[a]=[],!0}catch(f){return d._workers[a]="ignore",!1}}),c},a.prototype.reclaim=function(a){a&&a.source&&this._workers[a.source].push(a)}}}(),function(){"use strict";if("undefined"!=typeof window){var a=window.ActionQueue=function(){var b=this instanceof a?this:Object.create(a.prototype);return b._queueStack=[],b._stackIndex=0,b._isInAction=!1,b._isOffEventQueue=!1,b._previousAction=void 0,b._isFinished=!1,b};a.prototype.queueNext=function(){var a=this,b=Array.prototype.slice.call(arguments),c=a._isOffEventQueue?0:a._stackIndex;return a._isFinished?a:("undefined"==typeof a._queueStack[c]&&(a._queueStack[c]=[]),a._queueStack[c].push(b),a._nextAction(),a)},a.prototype._nextAction=function(a){var b,c,d,e=this;return a&&(e._isInAction=!1),e._isInAction||!function f(){e._isFinished||(d=e._queueStack[e._stackIndex],d&&d.length>0?(b=d.shift(),c=b.shift(),0===d.length&&e._queueStack.splice(e._stackIndex,1),e._isInAction=!0,e._previousAction=c,e._stackIndex++,e._callAction(function(){c.apply(e,b)})):e._stackIndex>0&&(e._stackIndex--,f()))}(),e},a.prototype._callAction=function(a){a()},a.prototype.beginAsynchronous=function(){var a=this;return a._isOffEventQueue=!0,a},a.prototype.finishAsynchronous=function(){var a=this;return a._isOffEventQueue=!1,a},a.prototype.finishAction=function(){var a=this;return a._nextAction(!0),a},a.prototype.finish=function(){var a=this;return a.queueNext(function(){a._previousAction=null,a._queueStack=null,a._isFinished=!0,a.finishAction()}),a},a.prototype.printToConsole=function(){var a=this,b="color: #D48919; font-weight: bold;",c="color: #D48919;";return console.group("Action Queue ["+(a._isInAction?"IN ACTION":"RESTING")+"]"),"undefined"!=typeof a._previousAction&&(console.groupCollapsed("%c"+(a._isInAction?"Current action:":"Previous action:"),b),console.log(""+a._previousAction.toString()),console.groupEnd()),console.groupCollapsed("%cQueue stack ["+a._queueStack.length+"]:",b),a._queueStack.forEach(function(a,b){console.groupCollapsed("%cQueue "+b+" ["+a.length+"]:",c),a.forEach(function(a,b){"undefined"!=typeof a&&console.log(b+": "+a.toString())}),console.groupEnd()}),console.groupEnd(),console.groupEnd(),a}}}(),DataWorkerHelperCreator(this),/*!
 * document.currentScript
 * Polyfill for `document.currentScript`.
 * Copyright (c) 2015 James M. Greene
 * Licensed MIT
 * http://jsfiddle.net/JamesMGreene/9DFc9/
 * v0.1.7
 */
function(){"use strict";function a(a){if("string"==typeof a&&a)for(var b=0,c=i.length;c>b;b++)if(i[b].src===a)return i[b];return null}function b(){for(var a=null,b=0,c=i.length;c>b;b++)if(!i[b].src){if(a)return null;a=i[b]}return a}function c(){var a=0;return"undefined"!=typeof e&&e&&"number"==typeof e.skipStackDepth&&(a=e.skipStackDepth),a}function d(a,b){var e,f,g,h="number"==typeof b;return b=h?b:c(),"string"==typeof a&&a&&(h?f=a.match(/(data:text\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/):(f=a.match(/^(?:|[^:@]*@|.+\)@(?=data:text\/javascript|blob|http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)(data:text\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),f&&f[1]||(f=a.match(/\)@(data:text\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/))),f&&f[1]&&(b>0?(g=a.slice(a.indexOf(f[0])+f[0].length),e=d(g,b-1)):e=f[1])),e}function e(){if(0===i.length)return null;if(1===i.length)return i[0];if("readyState"in i[0])for(var c=i.length;c--;)if("interactive"===i[c].readyState)return i[c];if("loading"===document.readyState)return i[i.length-1];var e,j=new Error;if(f&&(e=j.stack),!e&&g)try{throw j}catch(k){e=k.stack}if(e){var l=d(e),m=a(l);return m||l!==h||(m=b()),m}return null}if("undefined"!=typeof window){var f=!1,g=!1;!function(){try{var a=new Error;throw f="string"==typeof a.stack&&!!a.stack,a}catch(b){g="string"==typeof b.stack&&!!b.stack}}();var h=window.location.href,i=document.getElementsByTagName("script");e.skipStackDepth=1;var j=!("currentScript"in document),k=document.__defineGetter__,l="function"==typeof Object.defineProperty&&function(){var a;try{Object.defineProperty(document,"_xyz",{get:function(){return"blah"},configurable:!0}),a="blah"===document._xyz,delete document._xyz}catch(b){a=!1}return a}();document._currentScript=e,j&&(l?Object.defineProperty(document,"currentScript",{get:e}):k&&document.__defineGetter__("currentScript",e))}}(),function(){"use strict";function a(a,b){var c=b||0,d=a[c]instanceof Array?a[c]:Array.prototype.slice.call(a,c);return d}if("undefined"!=typeof window){var b=window.DataWorker=function c(a){var b=this instanceof c?this:Object.create(c.prototype);return b._columns={},b._rows=[],b._summaryRows=[],b._distinctRows=[],b._hash={},b._numRows=0,b._expectedNumRows=0,b._currentPage=void 0,b._numberOfPages=void 0,b._partitionedDatasets={},b._renderFunction=function(){},b._actionQueue=new ActionQueue,b._initializeCallbacks(a),b._initializeSettings(a),b._initializeDatasources(a),b._queueNext(function(){b._initializeWebWorker()}),b};b.currentScript=(document.currentScript||document._currentScript()||{}).src,b.ignoreProtocols={},b.workerPool=new WebWorkerPool,b.prototype.workerPool=b.workerPool,b.prototype._queueNext=function(a){var b=this;return b._actionQueue.queueNext(a),b},b.prototype._finishAction=function(a){var b=this;return a&&b._actionQueue.finishAsynchronous(),b._actionQueue.finishAction(),b},b.prototype._postMessage=function(a){var b=this;return b._actionQueue.beginAsynchronous(),b._worker.postMessage(a),b},b.prototype._initializeCallbacks=function(a){var b=this;return b._onReceiveColumnsTracker=!1,b._onReceiveColumns="onReceiveColumns"in a?function(){b._onReceiveColumnsTracker=!1,a.onReceiveColumns.apply(this,arguments)}:function(){},b._onAllRowsReceivedTracker=!1,b._onAllRowsReceived="onAllRowsReceived"in a?function(){b._onAllRowsReceivedTracker=!1,a.onAllRowsReceived.apply(this,arguments)}:function(){},b._onReceiveRows="onReceiveRows"in a?a.onReceiveRows:function(){},b._onTrigger="onTrigger"in a?a.onTrigger:function(){},b._onError="onError"in a?a.onError:function(a){"undefined"!=typeof console&&console.error&&console.error(a)},b},b.prototype._initializeSettings=function(a){var c=this,d=c._workerSources=[];if(a.forceSingleThread||"undefined"==typeof Worker)return c._isSingleThreaded=!0,c;if("workerSource"in a&&d.push(a.workerSource),!b.helperBlob)try{var e=DataWorkerHelperCreator+"; DataWorkerHelperCreator(this);";b.helperBlob=new Blob([e],{type:"application/javascript"}),b.helperBlobUrl=URL.createObjectURL(b.helperBlob)}catch(f){b.helperBlob=f}return b.helperBlobUrl&&d.push(b.helperBlobUrl),"backupWorkerSource"in a&&d.push(a.backupWorkerSource),b.currentScript&&d.push(b.currentScript),c._workerSources=d.filter(function(c){var d=b.ignoreProtocols[c]||{},e=[].concat(a.datasource||[]),f=e.some(function(a){return!d[(/^(wss?|https?|file):/.exec(a)||[])[1]]});return b.ignoreProtocols[c]=d,f}),c},b.prototype._initializeDatasources=function(a){var b,c,d,e=this,f=[],g=a.dataset||a;return g instanceof Array?(b=g.slice(0,1)[0],c=g.slice(1)):a.columns instanceof Array&&a.rows instanceof Array?(b=a.columns,c=a.rows):(f=a.datasource instanceof Array?a.datasource.slice(0):[a.datasource],d="string"==typeof a.request?a.request:JSON.stringify(a.request)),e._connectionSettings={index:0,datasources:f,message:{cmd:"initialize",columns:b,rows:c,authenticate:a.authenticate,request:d,onClose:a.onClose,shouldAttemptReconnect:a.shouldAttemptReconnect}},e},b.prototype._initializeWebWorker=function(){var a=this;return(a._worker=a.workerPool.getWorker(a._workerSources))||(a._isSingleThreaded=!0,a._worker=new DataWorkerHelper),a._worker.onmessage=function(b){return b.data?a._resettingWebworker?(a._resettingWebworker=!1,a.workerPool.reclaim(a._worker),a._worker.onmessage=null,a._initializeWebWorker()):"connected"in b.data&&!b.data.connected?a._connect(!0,b.data):"rowsReceived"in b.data?void(a._onReceiveRows&&a._onReceiveRows(b.data.rowsReceived)):"triggerMsg"in b.data?void(a._onTrigger&&a._onTrigger(b.data.triggerMsg)):"allRowsReceived"in b.data?(a._onAllRowsReceivedTracker=!0,void(a._onAllRowsReceived&&a._onAllRowsReceived())):("currentPage"in b.data&&(a._currentPage=b.data.currentPage),"numberOfPages"in b.data&&(a._numberOfPages=b.data.numberOfPages),"error"in b.data&&a._onError(b.data.error),"columns"in b.data&&(a._columns=b.data.columns),"rows"in b.data&&(a._rows=b.data.rows),"summaryRows"in b.data&&(a._summaryRows=b.data.summaryRows),"distinctRows"in b.data&&(a._distinctRows=b.data.distinctRows),"hash"in b.data&&(a._hash=b.data.hash),"keys"in b.data&&(a._keys=b.data.keys),"numRows"in b.data&&(a._numRows=b.data.numRows),"exNumRows"in b.data&&(a._expectedNumRows=b.data.exNumRows),"columnsReceived"in b.data?(a._onReceiveColumnsTracker=!0,void(a._onReceiveColumns&&a._onReceiveColumns())):void a._finishAction(!0)):void 0},a._connect(!1),a},b.prototype._connect=function(a,c){var d=this,e=d._connectionSettings,f=c&&c.error,g=c&&c.unsupported,h=e.message.columns&&e.message.rows&&!0,i=e.datasources.length>e.index;if(g&&d._worker.source){var j=e.datasources[e.index-1],k=(/^(wss?|https?|file):/.exec(j)||[])[1];b.ignoreProtocols[d._worker.source][k]}else f&&d._onError(f);if(i)e.message.datasource=e.datasources[e.index++];else if(!h)return d._worker.source?(d._workerSources=d._workerSources.filter(function(a){return d._worker.source!==a}),e.index=0,d._resettingWebworker=!0,d._postMessage({cmd:"finish"})):(d._onError("No available datasources."),d._finishAction(a)),d;return d._postMessage(e.message),d},b.prototype.finish=function(a){var b=this;return b.cancelOngoingRequests(),b._queueNext(function(){b._onReceiveColumns=null,b._onReceiveRows=null,b._onAllRowsReceived=null,b._onTrigger=null,b._onError=null,b._renderFunction=null,b._postMessage({cmd:"finish"})})._queueNext(function(){b.workerPool.reclaim(b._worker),b._actionQueue.finish(),b._worker.onmessage=null,b._worker=null,a&&a()}),b},b.prototype.getColumns=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"getColumns"})})._queueNext(function(){return a.call(b,b._columns),b._finishAction()}),b},b.prototype.getDistinctConsecutiveRows=function(){var a=this,b=arguments[0],c=arguments[1];return a._queueNext(function(){a._postMessage({cmd:"getDistinctConsecutiveRows",columnName:c})})._queueNext(function(){return b.call(a,a._distinctRows),a._finishAction()}),a},b.prototype._filter=function(a,b){var c=this;return c._queueNext(function(){c._postMessage({cmd:a,filters:b})}),c},b.prototype.clearFilters=function(){var a=this;return a._queueNext(function(){a._postMessage({cmd:"clearFilters"})}),a},b.prototype.applyFilter=function(){var b=this,c=a(arguments);return b._filter("applyFilter",c)},b.prototype.filter=function(){var b=this,c=a(arguments);return b._filter("filter",c)},b.prototype.applyLimit=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"applyLimit",numRows:a})}),b},b.prototype.limit=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"limit",numRows:a})}),b},b.prototype.sort=function(){var b=this,c=a(arguments);return b._queueNext(function(){b._postMessage({cmd:"sort",sortOn:c})}),b},b.prototype.setDecimalMarkCharacter=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"setDecimalMarkCharacter",decimalMarkCharacter:a})}),b},b.prototype.removeColumns=function(){var b=this,c=a(arguments);return b._queueNext(function(){b._postMessage({cmd:"removeColumns",columnsToRemove:c})}),b},b.prototype.paginate=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"paginate",rowsPerPage:a})}),b},b.prototype.getNextPage=function(b){var c=this,d=a(arguments,1);return c._queueNext(function(){c._getPage(void 0,!0,!1,d)})._queueNext(function(){return b.call(c,c._rows,c._currentPage),c._finishAction()}),c},b.prototype.getPreviousPage=function(b){var c=this,d=a(arguments,1);return c._queueNext(function(){c._getPage(void 0,!1,!0,d)})._queueNext(function(){return b.call(c,c._rows,c._currentPage),c._finishAction()}),c},b.prototype.getNumberOfPages=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"getNumberOfPages"})})._queueNext(function(){return a.call(b,b._numberOfPages),b._finishAction()}),b},b.prototype._getPage=function(a,b,c,d){var e=this;return e._postMessage({cmd:"getPage",pageNum:a,columnNames:d,incrementPage:b,decrementPage:c}),e},b.prototype.getPage=function(b,c){var d=this,e=a(arguments,2);return d._queueNext(function(){d._getPage(c,void 0,void 0,e)})._queueNext(function(){b.call(d,d._rows,d._currentPage),d._finishAction()}),d},b.prototype.setPage=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"setPage",pageNum:a})}),b},b.prototype.getRows=function(b,c,d){var e=this,f=a(arguments,3);return e._queueNext(function(){e._postMessage({cmd:"getRows",start:c,end:d,columnNames:f})})._queueNext(function(){b.call(e,e._rows),e._finishAction()}),e},b.prototype.getHashedRows=function(b,c,d){var e=this,f=a(arguments,3);return e._queueNext(function(){e._postMessage({cmd:"getHashedRows",start:c,end:d,columnNames:f})})._queueNext(function(){b.call(e,e._rows),e._finishAction()}),e},b.prototype.getColumnsAndRecords=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"refresh"})})._queueNext(function(){return a.call(b,b._columns,b._rows),b._finishAction()}),b},b.prototype.getAllColumnsAndAllRecords=function(a,b){var c=this;return c._queueNext(function(){c._postMessage({cmd:"refreshAll",complexValues:b})})._queueNext(function(){return a.call(c,c._columns,c._rows),c._finishAction()}),c},b.prototype.append=function(a){var c=this;return c._queueNext(function(){a instanceof b?a.getAllColumnsAndAllRecords(function(a,b){c._postMessage({cmd:"append",newColumns:a,newRows:b})},!0):c._postMessage({cmd:"append",newColumns:a.slice(0,1)[0],newRows:a.slice(1)})}),c},b.prototype.join=function(a,b,c,d){{var e,f,g=this;Array.prototype.slice.call(arguments)}return g._queueNext(function(){return b.length&&c.length||g._onError("No join key(s) provided."),b.length!=c.length&&g._onError("Odd number of join keys."),"undefined"!=typeof d&&"left"!==d&&"right"!==d&&"inner"!==d&&g._onError("Unknown join type."),g._finishAction()}),g._queueNext(function(){g._postMessage({cmd:"getAllColumns"})})._queueNext(function(){a.getAllColumns(function(a){return Object.keys(a).forEach(function(a){a in g._columns&&g._onError("Column names overlap.")}),f=a,g._finishAction()})})._queueNext(function(){a.getHashOfDatasetByKeyColumns.call(a,function(a){return e=a,g._finishAction()},c)})._queueNext(function(){g._postMessage({cmd:"join",keyColumns:b,rHash:e,joinType:d,fColumns:f})}),g},b.prototype.getHashOfDatasetByKeyColumns=function(a,b){var c=this;return c._queueNext(function(){c._postMessage({cmd:"hash",keyColumns:b})})._queueNext(function(){return a.call(c,c._hash),c._finishAction()}),c},b.prototype.prependColumnNames=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"prependColumnNames",prepend:a})}),b},b.prototype.alterColumnName=function(a,b){var c=this;return c._queueNext(function(){c._postMessage({cmd:"alterColumnName",oldName:a,newName:b})}),c},b.prototype.alterColumnSortType=function(a,b){var c=this;return c._queueNext(function(){c._postMessage({cmd:"alterColumnSortType",column:a,sortType:b})}),c},b.prototype.alterColumnAggregateType=function(a,b){var c=this;return c._queueNext(function(){c._postMessage({cmd:"alterColumnAggType",column:a,aggType:b})}),c},b.prototype.alterColumnTitle=function(a,b){var c=this;return c._queueNext(function(){c._postMessage({cmd:"alterColumnTitle",column:a,title:b})}),c},b.prototype.group=function(){var b=this,c=a(arguments);return b._queueNext(function(){b._postMessage({cmd:"group",keyColumns:c})}),b},b.prototype.partition=function(){var b=this,c=a(arguments);return b._queueNext(function(){b._postMessage({cmd:"partition",keyColumns:c})}),b},b.prototype.getPartitionKeys=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"getPartitionKeys"})})._queueNext(function(){a.call(b,b._keys),b._finishAction()}),b},b.prototype.getPartitioned=function(){var b=this,c=arguments[0],d=a(arguments,1);return b._queueNext(function(){b._postMessage({cmd:"getPartitioned",key:d.join("|")})})._queueNext(function(){return c.call(b,b._rows),b._finishAction()}),b},b.prototype.sortPartition=function(){var b=this,c=arguments[0],d=a(arguments,1);return b._queueNext(function(){b._postMessage({cmd:"sortPartition",key:c,sortOn:d})}),b},b.prototype.render=function(a){var b=this;return b._queueNext("function"==typeof a?function(){return b._renderFunction=a,b._finishAction()}:function(){return b._renderFunction(),b._finishAction()}),b},b.prototype.onError=function(a,b){var c=this;return b?c._onError=a:c._queueNext(function(){return c._onError=a,c._finishAction()}),c},b.prototype.onReceiveColumns=function(a,b){var c=this,d=function(){c._onReceiveColumnsTracker=!1,a.apply(this,arguments)};return"function"==typeof a&&(b?(c._onReceiveColumns=d,c._onReceiveColumnsTracker&&a.call(c,c._columns,c._expectedNumRows)):c._queueNext(function(){return c._onReceiveColumns=d,c._onReceiveColumnsTracker&&a.call(c,c._columns,c._expectedNumRows),c._finishAction()})),c},b.prototype.onReceiveRows=function(a,b){var c=this;return"function"==typeof a&&(b?c._onReceiveRows=a:c._queueNext(function(){return c._onReceiveRows=a,c._finishAction()})),c},b.prototype.onTrigger=function(a,b){var c=this;return"function"==typeof a&&(b?c._onTrigger=a:c._queueNext(function(){return c._onTrigger=a,c._finishAction()})),c},b.prototype.onAllRowsReceived=function(a,b){var c=this,d=function(){c._onAllRowsReceivedTracker=!1,a.apply(this,arguments)};return"function"==typeof a&&(b?(c._onAllRowsReceived=d,c._onAllRowsReceivedTracker&&a.call(c)):c._queueNext(function(){return c._onAllRowsReceived=d,c._onAllRowsReceivedTracker&&a.call(c),c._finishAction()})),c},b.prototype.getNumberOfRecords=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"getNumberOfRecords"})})._queueNext(function(){return a.call(b,b._numRows),b._finishAction()}),b},b.prototype.clone=function(a){var c=this;return c.getAllColumnsAndAllRecords(function(d,e){var f=Object.keys(d).map(function(a){return d[a]}).sort(function(a,b){return a.index-b.index}),g=[f].concat(e);a.call(c,new b(g))},!0),c},b.prototype.getExpectedNumberOfRecords=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"getExpectedNumRows"})})._queueNext(function(){return a.call(b,b._expectedNumRows),b._finishAction()}),b},b.prototype.requestDataset=function(a,b){var c=this,d="requestDataset";return b?d+="ForAppend":c.cancelOngoingRequests(),c._queueNext(function(){c._onAllRowsReceivedTracker=!1,c._onReceiveColumnsTracker=!1,c._postMessage({cmd:d,request:a})}),c},b.prototype.requestDatasetForAppend=function(a){return this.requestDataset(a,!0)},b.prototype._hideShowColumns=function(a,b){var c=this,d={cmd:a};return"string"==typeof b[0]?d.columnNames=b:b[0]instanceof RegExp?d.columnNameRegex=b[0]:"property"in b[0]&&"value"in b[0]&&(d.property=b[0]),c._queueNext(function(){c._postMessage(d)}),c},b.prototype.hideColumns=function(){var b=this,c=a(arguments);return b._hideShowColumns("hideColumns",c),b},b.prototype.showColumns=function(){var b=this,c=a(arguments);return b._hideShowColumns("showColumns",c),b},b.prototype.hideAllColumns=function(){var a=this;return a._queueNext(function(){a._postMessage({cmd:"hideAllColumns"})}),a},b.prototype.showAllColumns=function(){var a=this;return a._queueNext(function(){a._postMessage({cmd:"showAllColumns"})}),a},b.prototype.getAllColumns=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"getAllColumns"})})._queueNext(function(){return a.call(b,b._columns),b._finishAction()}),b},b.prototype.addChildRows=function(a,c){var d=this;return d._queueNext(function(){var e=function(a){d._postMessage({cmd:"addChildRows",joinOn:c,rows:a})};a instanceof b?a.getRows(function(a){e.call(d,a)}):e.call(d,a)}),d},b.prototype.postMessage=function(a){var b=this;return b._queueNext(function(){b._postMessage({cmd:"postMessage",message:a})}),b},b.prototype.getSummaryRows=function(b){var c=this,d=a(arguments,1);return c._queueNext(function(){c._postMessage({cmd:"getSummaryRows",columnNames:d})})._queueNext(function(){return b.call(c,c._summaryRows),c._finishAction()}),c},b.prototype.setSummaryRows=function(){var a=this,b=1===arguments.length?arguments[0]:Array.prototype.slice.call(arguments);a._queueNext(function(){a._postMessage({cmd:"setSummaryRows",summaryRows:b})})},b.prototype.clearDataset=function(){var a=this;return a._queueNext(function(){a._postMessage({cmd:"clearDataset"})}),a},b.prototype.cancelOngoingRequests=function(){var a=this;return a._queueNext(function(){a._postMessage({cmd:"cancelOngoingRequests"})}),a},b.prototype.search=function(a,b,c){var d=this;return"undefined"==typeof c&&(c={}),("string"==typeof b||b instanceof RegExp)&&(b=[b,c.searchOn||c.columns].filter(function(a){return!!a})),d._queueNext(function(){d._postMessage({cmd:"search",filters:b,columns:c.columns,allRows:c.allRows,getDistinct:c.getDistinct,sortOn:c.sortOn,searchOn:c.searchOn,returnColumns:c.returnColumns,fromRow:c.fromRow||0,limit:c.limit})})._queueNext(function(){a.call(d,d._rows),d._finishAction()}),d}}}();
//# sourceMappingURL=dataworker.min.js.map